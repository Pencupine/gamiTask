<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
  <style>
  </style>
  <script src="https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.js"></script>
  <link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.css" />
  <script src="https://www.gstatic.com/firebasejs/7.3.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.3.0/firebase-auth.js"></script>
  <!-- BluePRintJS -->
  <link href="path/to/node_modules/@blueprintjs/core/lib/css/blueprint.css" rel="stylesheet" />
  <link href="path/to/node_modules/@blueprintjs/icons/lib/css/blueprint-icons.css" rel="stylesheet" />
</head>
<body>
  <div id="firebaseui-auth-container"></div>
  <div id="loader">Loading...</div> 
  <div id="authCheck">Wait</div>
  <!-- <div id="spinner"> -->
  </div>

  </div>
  <script>

    const tokenManager = require('./tokenManager');
    const electron = require('electron');

    var firebaseConfig = {
      apiKey: "AIzaSyBkB36J6iOzka1gZhlR9Ye_smCR0f5s1h8",
      authDomain: "testbrowserview.firebaseapp.com",
      databaseURL: "https://testbrowserview.firebaseio.com",
      projectId: "testbrowserview",
      storageBucket: "testbrowserview.appspot.com",
      messagingSenderId: "206998722994",
      appId: "1:206998722994:web:b33e295a948ef906ec6cab"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);

    firebase.auth().onAuthStateChanged(function(user) {
      if (user) {
        console.log(firebase.auth().currentUser);
        firebase.auth().currentUser.getIdToken(true).then(idToken => {
          electron.ipcRenderer.send('saveToken', idToken);
          // firebase.auth().signout();
        });
        document.getElementById('authCheck').style.display = 'none';
        document.getElementById('firebaseui-auth-container').style.display = 'none';
      } else {
        document.getElementById('authCheck').style.display = 'inline';
      }
    })
    
    var ui = new firebaseui.auth.AuthUI(firebase.auth());
    
    var uiConfig = {
      callbacks: {
        signInSuccessWithAuthResult: function(authResult, redirectUrl) {
          
          firebase.auth().currentUser.getIdToken(true).then(idToken => {
            console.log(idToken);
            tokenManager.saveToken(idToken);
          });
          
          document.getElementById('loader').innerHTML = "Signed In"
          
          return false;
          
        },
        uiShown: function() {
          
          document.getElementById('loader').style.display = 'none';
        }
      },
      signInFlow: 'redirect',
      signInOptions: [
        firebase.auth.EmailAuthProvider.PROVIDER_ID
        // firebase.auth.GoogleAuthProvider.PROVIDER_ID,
        // firebase.auth.FacebookAuthProvider.PROVIDER_ID,
        // firebase.auth.TwitterAuthProvider.PROVIDER_ID,
        // firebase.auth.GithubAuthProvider.PROVIDER_ID,
        // signInMethod: firebase.auth.EmailAuthProvider.EMAIL_LINK_SIGN_IN_METHOD,
        // forceSameDevice: false,
        // emailLinkSignIn: function() {
          // }
        ]
      };
      
      ui.start('#firebaseui-auth-container', uiConfig);
    // ui.start('#firebaseui-auth-container', uiConfig);

  </script>
</body>
</html>